-- [[ ACUSADO NINJA HUB MASHMELLOW - SECURITY EDITION ]] --
-- SEGURIDAD ACTIVADA | LOGICA DE FARM PRESERVADA

local _K = "BACK01"
local lp = game:GetService("Players").LocalPlayer
local vim = game:GetService("VirtualInputManager")
local vu = game:GetService("VirtualUser")
local coreGui = game:GetService("CoreGui")
local http = game:GetService("HttpService")

if not lp or not coreGui then return end

local function GetRnd() return http:GenerateGUID(false) end

-- Limpieza de GUIs antiguas
for _, v in pairs(coreGui:GetChildren()) do
    if v:FindFirstChild("AC_TAG_SEC") then v:Destroy() end
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = GetRnd()
ScreenGui.Parent = coreGui
ScreenGui.ResetOnSpawn = false
local tag = Instance.new("BoolValue", ScreenGui)
tag.Name = "AC_TAG_SEC"

local MainBlue = Color3.fromRGB(0, 160, 255)
local DarkBg = Color3.fromRGB(7, 7, 10)

-- [ BOTÓN DE REGRESO (MINIMIZADO) ]
local OpenBtn = Instance.new("TextButton", ScreenGui)
OpenBtn.Size = UDim2.new(0, 50, 0, 50)
OpenBtn.Position = UDim2.new(0, 10, 0.5, -25)
OpenBtn.BackgroundColor3 = DarkBg
OpenBtn.Text = "NINJA"
OpenBtn.TextColor3 = MainBlue
OpenBtn.Font = Enum.Font.GothamBold
OpenBtn.Visible = false
Instance.new("UICorner", OpenBtn)
Instance.new("UIStroke", OpenBtn).Color = MainBlue

-- [ LOGIN ]
local LoginFrame = Instance.new("Frame", ScreenGui)
LoginFrame.Size = UDim2.new(0, 300, 0, 200)
LoginFrame.Position = UDim2.new(0.5, -150, 0.4, -100)
LoginFrame.BackgroundColor3 = DarkBg
Instance.new("UICorner", LoginFrame)
Instance.new("UIStroke", LoginFrame).Color = MainBlue

local LTitle = Instance.new("TextLabel", LoginFrame)
LTitle.Size = UDim2.new(1, 0, 0, 40)
LTitle.Text = "MASHMELLOW SECURITY"
LTitle.TextColor3 = MainBlue
LTitle.Font = Enum.Font.GothamBold
LTitle.BackgroundTransparency = 1

local KeyInput = Instance.new("TextBox", LoginFrame)
KeyInput.Size = UDim2.new(0.8, 0, 0, 40)
KeyInput.Position = UDim2.new(0.1, 0, 0.4, 0)
KeyInput.PlaceholderText = "ENTER KEY"
KeyInput.BackgroundColor3 = Color3.fromRGB(15, 20, 30)
KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", KeyInput)

local LoginBtn = Instance.new("TextButton", LoginFrame)
LoginBtn.Size = UDim2.new(0.8, 0, 0, 40)
LoginBtn.Position = UDim2.new(0.1, 0, 0.75, 0)
LoginBtn.BackgroundColor3 = MainBlue
LoginBtn.Text = "VERIFICAR"
LoginBtn.Font = Enum.Font.GothamBold
Instance.new("UICorner", LoginBtn)

-- [ HUB PRINCIPAL ]
local function StartHub()
    LoginFrame:Destroy()
    
    local MainFrame = Instance.new("Frame", ScreenGui)
    MainFrame.Size = UDim2.new(0, 460, 0, 350)
    MainFrame.Position = UDim2.new(0.5, -230, 0.5, -175)
    MainFrame.BackgroundColor3 = DarkBg
    MainFrame.Active = true
    MainFrame.Draggable = true
    Instance.new("UICorner", MainFrame)
    Instance.new("UIStroke", MainFrame).Color = MainBlue

    -- Botón de Cerrar (X)
    local CloseBtn = Instance.new("TextButton", MainFrame)
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Position = UDim2.new(1, -35, 0, 5)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.new(1,1,1)
    CloseBtn.Font = Enum.Font.GothamBold
    Instance.new("UICorner", CloseBtn)

    CloseBtn.MouseButton1Click:Connect(function()
        MainFrame.Visible = false
        OpenBtn.Visible = true
    end)

    OpenBtn.MouseButton1Click:Connect(function()
        MainFrame.Visible = true
        OpenBtn.Visible = false
    end)

    local Title = Instance.new("TextLabel", MainFrame)
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.Text = "ACUSADO NINJA HUB MASHMELLOW"
    Title.TextColor3 = MainBlue
    Title.Font = Enum.Font.GothamBold
    Title.BackgroundTransparency = 1

    local InfoLabel = Instance.new("TextLabel", MainFrame)
    InfoLabel.Size = UDim2.new(0.55, 0, 0, 260)
    InfoLabel.Position = UDim2.new(0.05, 0, 0, 65)
    InfoLabel.BackgroundColor3 = Color3.fromRGB(10, 15, 25)
    InfoLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    InfoLabel.Font = Enum.Font.Code
    InfoLabel.TextSize = 12
    InfoLabel.TextXAlignment = Enum.TextXAlignment.Left
    InfoLabel.TextYAlignment = Enum.TextYAlignment.Top
    Instance.new("UICorner", InfoLabel)

    local function CreateBtn(txt, pos)
        local b = Instance.new("TextButton", MainFrame)
        b.Size = UDim2.new(0.33, 0, 0, 50)
        b.Position = pos
        b.BackgroundColor3 = Color3.fromRGB(20, 30, 50)
        b.TextColor3 = Color3.fromRGB(255, 255, 255)
        b.Font = Enum.Font.GothamBold
        b.Text = txt
        Instance.new("UICorner", b)
        return b
    end

    local FarmBtn = CreateBtn("FARM MASHMELLOW", UDim2.new(0.63, 0, 0, 65))
    local SellBtn = CreateBtn("SELL MASHMELLOW", UDim2.new(0.63, 0, 0, 130))
    local ToolBtn = CreateBtn("MASHMELLOW TOOL", UDim2.new(0.63, 0, 0, 195))

    local farmActive, sellActive = false, false
    local items = {"Water", "Sugar Block Bag", "Gelatin", "Empty Bag"}

    FarmBtn.MouseButton1Click:Connect(function()
        farmActive = not farmActive
        FarmBtn.Text = farmActive and "STOP FARM" or "FARM MASHMELLOW"
        FarmBtn.BackgroundColor3 = farmActive and Color3.fromRGB(150, 0, 0) or Color3.fromRGB(20, 30, 50)
        task.spawn(function()
            while farmActive do
                pcall(function()
                    for _, itemName in ipairs(items) do
                        if not farmActive then break end
                        local char = lp.Character
                        local tool = lp.Backpack:FindFirstChild(itemName) or (char and char:FindFirstChild(itemName))
                        if tool and char and char:FindFirstChild("Humanoid") then
                            char.Humanoid:EquipTool(tool)
                            task.wait(0.3)
                            vim:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                            task.wait(0.1)
                            vim:SendMouseButtonEvent(0, 0, 0, false, game, 0)
                            task.wait(0.2)
                            vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                            task.wait(0.1)
                            vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                            task.wait(1.5)
                        end
                    end
                end)
                task.wait(0.5)
            end
        end)
    end)

    SellBtn.MouseButton1Click:Connect(function()
        sellActive = not sellActive
        SellBtn.Text = sellActive and "AUTO-SELL ON" or "SELL MASHMELLOW"
        SellBtn.BackgroundColor3 = sellActive and Color3.fromRGB(0, 120, 80) or Color3.fromRGB(20, 30, 50)
    end)

    ToolBtn.MouseButton1Click:Connect(function()
        local t = Instance.new("Tool", lp.Backpack)
        t.Name = "MASHMELLOW DELETE"
        t.RequiresHandle = false
        t.Activated:Connect(function()
            local m = lp:GetMouse()
            if m.Target then pcall(function() m.Target:Destroy() end) end
        end)
    end)

    task.spawn(function()
        while task.wait(1) do
            local char = lp.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then continue end
            if sellActive then
                local isNear = false
                for _, v in pairs(workspace:GetDescendants()) do
                    if (v.Name:lower():find("sell") or v.Name:lower():find("buyer") or v:IsA("ProximityPrompt")) then
                        local pos = v:IsA("Model") and v.PrimaryPart and v.PrimaryPart.Position or (v:IsA("BasePart") and v.Position)
                        if pos and (char.HumanoidRootPart.Position - pos).Magnitude < 15 then isNear = true break end
                    end
                end
                if isNear then
                    pcall(function()
                        for _, i in pairs(lp.Backpack:GetChildren()) do
                            if i.Name:find("Small") or i.Name:find("Medium") or i.Name:find("Large") then
                                char.Humanoid:EquipTool(i)
                                task.wait(0.2)
                                vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                                task.wait(0.1)
                            end
                        end
                    end)
                end
            end
            local c = {W=0, S=0, G=0, B=0, Sm=0, M=0, L=0}
            local inv = lp.Backpack:GetChildren()
            for _, v in pairs(char:GetChildren()) do table.insert(inv, v) end
            for _, i in pairs(inv) do
                if i.Name == "Water" then c.W=c.W+1 
                elseif i.Name == "Sugar Block Bag" then c.S=c.S+1 
                elseif i.Name == "Gelatin" then c.G=c.G+1 
                elseif i.Name == "Empty Bag" then c.B=c.B+1 
                elseif i.Name:find("Small") then c.Sm=c.Sm+1 
                elseif i.Name:find("Medium") then c.M=c.M+1 
                elseif i.Name:find("Large") then c.L=c.L+1 end
            end
            InfoLabel.Text = string.format("\n [ ACUSADO MASHMELLOW HUB ]\n\n PRODUCTOS:\n - Small: %d\n - Medium: %d\n - Large: %d\n\n MATERIALES:\n - Agua: %d\n - Azucar: %d\n - Gelatina:%d\n - Bolsas: %d\n\n [ SEGURIDAD ]\n Status: Protegido\n Key: Verified", c.Sm, c.M, c.L, c.W, c.S, c.G, c.B)
        end
    end)
end

LoginBtn.MouseButton1Click:Connect(function()
    if KeyInput.Text == _K then StartHub() else LoginBtn.Text = "ERROR" task.wait(1) LoginBtn.Text = "VERIFICAR" end
end)

lp.Idled:Connect(function() vu:CaptureController() vu:ClickButton2(Vector2.new()) end)
